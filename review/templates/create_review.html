{% extends "base.html" %}

{% block content %}
<div class="container mx-auto py-10 flex justify-center font-merriweather">
    <!-- Review Form Container -->
    <div class="w-full max-w-2xl bg-white rounded-lg shadow-lg border border-gray-200 p-6">
        
        <!-- Header Section -->
        <div class="bg-gray-200 p-6 rounded-t-lg text-center">
            <h1 class="text-3xl font-bold text-gray-700">Write a Review</h1>
        </div>
        
        <!-- Product Preview Section -->
        <div class="flex items-center border rounded-lg mt-6 p-4 bg-gray-50 shadow-sm">
            {% if menu_item.image %}
                <img src="{{ menu_item.image }}" alt="{{ menu_item.name }}" class="w-24 h-24 object-cover rounded-md mr-4">
            {% endif %}
            <div>
                <h2 class="text-xl font-bold text-gray-800">{{ menu_item.name }}</h2>
                <p class="text-gray-600">{{ menu_item.description }}</p>
                <a href="{% url 'product:menu_detail' menu_item.id %}" class="text-sm text-gray-500 hover:underline mt-2 inline-block">Menu Description</a>
            </div>
        </div>

        <!-- Review Form -->
        <form method="post" enctype="multipart/form-data" class="text-left mt-6">
            {% csrf_token %}

            <!-- Review Text Area -->
            <div class="mb-4">
                <label class="block text-lg font-semibold text-gray-700 mb-1">Write A Review</label>
                <textarea name="review_text" rows="4" maxlength="250" class="w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300" placeholder="Tell us what you like about this product!"></textarea>
                <div class="text-right text-sm text-gray-400 mt-1">max 250</div>
            </div>

            <!-- Rating Input -->
            <div class="mb-4">
                <label class="block text-lg font-semibold text-gray-700 mb-1">Rating (1-5)</label>
                <input type="number" step="0.1" min="1" max="5" name="rating" class="w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300" placeholder="Enter rating">
            </div>

            <!-- Photo Upload Section -->
            <div class="mb-6">
                <label class="block text-lg font-semibold text-gray-700 mb-1">Add Photo</label>
                <div class="bg-gray-100 border-2 border-dashed border-gray-300 p-6 rounded-lg text-center cursor-pointer relative" id="upload-box">
                    <input type="file" name="review_image" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer" id="upload-photo" onchange="previewImage(event)">
                    <!-- Image Preview -->
                    <img id="frame" src="" class="hidden w-full h-full object-cover rounded-lg" alt="Image Preview">
                    <span id="upload-text" class="text-brown-600 font-semibold">Click to upload (Max 1 photo & max 5 MB)</span>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="w-full py-3 bg-gray-800 text-white font-bold rounded-lg hover:bg-blue-800 transition duration-200">Publish</button>
        </form>
        
        <!-- Back to Product Link -->
        <div class="text-center mt-6">
            <a href="{% url 'product:menu_detail' menu_item.id %}" class="text-gray-500 hover:text-gray-800">Back to Product</a>
        </div>
    </div>
</div>
{% endblock %}

<style>
    /* Apply Merriweather font globally within this container */
    .container, .font-merriweather {
        font-family: 'Merriweather', serif;
    }
    
    /* Box shadow and border styling */
    .shadow-sm {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* Center the text */
    #upload-box {
        position: relative;
        overflow: hidden;
    }
    #upload-photo {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    /* Brown color styling */
    .text-brown-600 {
        color: #8B4513; /* Coklat tua */
    }
</style>

<script>
    // JavaScript to preview the uploaded image using URL.createObjectURL
    function previewImage(event) {
        const file = event.target.files[0];
        const frame = document.getElementById('frame');
        const uploadText = document.getElementById('upload-text');
        
        if (file) {
            frame.src = URL.createObjectURL(file);
            frame.classList.remove('hidden'); // Show the preview image
            uploadText.classList.add('hidden'); // Hide the upload text

            // Release memory when the image is loaded
            frame.onload = function() {
                URL.revokeObjectURL(frame.src);
            };
        }
    }
</script>
