{% extends "base.html" %}

{% block content %}
<div class="container mx-auto py-10 flex justify-center font-merriweather">
    <!-- Review Form Container -->
    <div class="w-full max-w-2xl bg-white rounded-lg shadow-lg border border-gray-200 p-6">
        
        <!-- Header Section -->
        <div class="bg-gray-200 p-6 rounded-t-lg text-center">
            <h1 class="text-3xl font-bold text-gray-700">Write a Review</h1>
        </div>
        
        <!-- Product Preview Section -->
        <div class="flex items-center border rounded-lg mt-6 p-4 bg-gray-50 shadow-sm">
            {% if menu_item.image %}
                <img src="{{ menu_item.image }}" alt="{{ menu_item.name }}" class="w-24 h-24 object-cover rounded-md mr-4">
            {% endif %}
            <div>
                <p class="text-lg font-semibold text-gray-500">{{ menu_item.restaurant.name }}</p>
                <h2 class="text-xl font-bold text-gray-800">{{ menu_item.name }}</h2>
                <p class="text-gray-600">{{ menu_item.description }}</p>
                <a href="{% url 'product:menu_detail' menu_item.id %}" class="text-sm text-gray-500 hover:underline mt-2 inline-block">Menu Details</a>
            </div>
        </div>

        <!-- Review Form -->
        <form method="post" enctype="multipart/form-data" class="text-left mt-6">
            {% csrf_token %}

            <div class="mb-4">
                <label class="block text-lg font-semibold text-gray-700 mb-1">Write A Review</label>
                <textarea name="review_text" rows="4" maxlength="250" class="w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300" placeholder="Tell us what you like about this product!"></textarea>
                <div class="text-right text-sm text-gray-400 mt-1">max 250</div>
            </div>

            <div class="mb-4">
                <label class="block text-lg font-semibold text-gray-700 mb-1">Rating (1-5)</label>
                <input type="number" step="0.1" min="1" max="5" name="rating" class="w-full px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-gray-300" placeholder="Enter rating">
            </div>

            <!-- Photo Upload Section -->
            <div class="mb-6">
                <label class="block text-lg font-semibold text-gray-700 mb-1">Add Photo</label>
                <div class="bg-gray-100 border-2 border-dashed border-gray-300 p-6 rounded-lg text-center cursor-pointer relative" id="upload-box">
                    <input type="file" accept=".jpg, .jpeg, .png" id="file-upload" class="absolute inset-0 opacity-0 cursor-pointer">
                    <!-- Image Preview -->
                    <img id="file-preview" src="#" alt="Preview Uploaded Image" class="hidden w-full h-full object-cover rounded-lg">
                    <div id="upload-text" class="text-brown-600 font-semibold">Click to upload (Max 1 photo & max 5 MB)</div>
                    <div id="upload-confirmation" class="hidden text-green-600 mt-2 flex items-center justify-center">
                        <span class="material-icons">check_circle</span>
                        <span class="ml-2">Image uploaded successfully!</span>
                    </div>
                </div>
                <p class="text-sm text-red-500 mt-2">Image cannot be changed after upload</p>
            </div>
            

            <button type="submit" class="w-full py-3 bg-gray-800 text-white font-bold rounded-lg hover:bg-blue-800 transition duration-200">Publish</button>
        </form>
        
        <div class="text-center mt-6">
            <a href="{% url 'product:menu_detail' menu_item.id %}" class="text-gray-500 hover:text-gray-800">Back to Product</a>
        </div>
    </div>
</div>
{% endblock %}

<style>
    .container, .font-merriweather {
        font-family: 'Merriweather', serif;
    }
    .shadow-sm {
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    #upload-box {
        position: relative;
        overflow: hidden;
    }
    #upload-photo {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }
    .text-brown-600 {
        color: #8B4513;
    }
</style>
<script>
    // Get the file input and set up the event listener
    const input = document.getElementById('file-upload');
    input.addEventListener('change', previewPhoto);

    function previewPhoto() {
        const file = input.files[0];
        const preview = document.getElementById('file-preview');
        const uploadText = document.getElementById('upload-text');
        const uploadConfirmation = document.getElementById('upload-confirmation');

        if (file) {
            const fileReader = new FileReader();

            // When the file is loaded, set the image src to display it
            fileReader.onload = function(event) {
                preview.setAttribute('src', event.target.result);
                preview.classList.remove('hidden'); // Show the image preview
                uploadText.classList.add('hidden'); // Hide the upload instruction text
                uploadConfirmation.classList.remove('hidden'); // Show success message
            };

            fileReader.readAsDataURL(file); // Convert the file to a URL
        }
    }
</script>
